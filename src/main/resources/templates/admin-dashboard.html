<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - VanlangBooks</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #f4f6f9; }
        .sidebar {
            width: 250px; background: #2c3e50; color: white; height: 100vh; position: fixed; padding: 1.5rem 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        .sidebar h5 { margin: 0 0 0.5rem; font-weight: 600; }
        .sidebar a {
            color: #bdc3c7; padding: 0.8rem 1.5rem; display: block; text-decoration: none;
            border-left: 3px solid transparent; transition: all 0.3s;
        }
        .sidebar a:hover, .sidebar a.active {
            background: #34495e; color: white; border-left-color: #e67e22;
        }
        .main-content { margin-left: 250px; padding: 2rem; min-height: 100vh; }
        .stat-card {
            background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center; transition: transform 0.2s;
        }
        .stat-card:hover { transform: translateY(-3px); }
        .stat-card h5 { margin: 0 0 0.5rem; color: #7f8c8d; font-size: 0.95rem; }
        .stat-card h4 { margin: 0; font-weight: 700; }
        .filter-btn {
            background: #e67e22; color: white; border: none; border-radius: 8px;
            padding: 0.5rem 1.5rem; font-weight: 500;
        }
        .chart-container {
            background: white; border-radius: 12px; padding: 1.5rem; margin-top: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .chart-container h5 { margin-bottom: 1rem; color: #2c3e50; }
    </style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
    <div class="text-center mb-4 px-3">
        <h5>VanlangBooks</h5>
        <small>Admin Panel</small>
    </div>
    <a th:href="@{/admin/dashboard}" class="active"><i class="fas fa-tachometer-alt me-2"></i> Dashboard</a>
    <a th:href="@{/admin/books}"><i class="fas fa-book me-2"></i> Sách</a>
    <a th:href="@{/admin/orders}"><i class="fas fa-shopping-bag me-2"></i> Đơn hàng</a>
    <a th:href="@{/admin/users}"><i class="fas fa-users me-2"></i> Người dùng</a>
    <a th:href="@{/}"><i class="fas fa-store me-2"></i> Trang bán</a>
    <a th:href="@{/logout}" class="text-danger"><i class="fas fa-sign-out-alt me-2"></i> Đăng xuất</a>
</div>

<!-- Main Content -->
<div class="main-content">
    <h3 class="mb-4">Thống kê bán hàng</h3>

    <!-- Bộ lọc ngày -->
    <form th:action="@{/admin/dashboard}" method="get" class="row g-3 mb-4 align-items-end">
        <div class="col-md-3">
            <label class="form-label fw-semibold">Từ ngày</label>
            <input type="date" name="from" class="form-control" th:value="${fromDate}">
        </div>
        <div class="col-md-3">
            <label class="form-label fw-semibold">Đến ngày</label>
            <input type="date" name="to" class="form-control" th:value="${toDate}">
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn filter-btn w-100">Lọc</button>
        </div>
    </form>

    <!-- Thẻ thống kê -->
    <div class="row g-3">
        <div class="col-md-3">
            <div class="stat-card">
                <h5>Doanh thu hôm nay</h5>
                <h4 class="text-primary" th:text="${#numbers.formatInteger(todayRevenue, 0, 'COMMA')} + ' đ'">0 đ</h4>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <h5>Doanh thu tháng này</h5>
                <h4 class="text-success" th:text="${#numbers.formatInteger(monthRevenue, 0, 'COMMA')} + ' đ'">0 đ</h4>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <h5>Tổng đơn hàng</h5>
                <h4 class="text-info" th:text="${totalOrders}">0</h4>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <h5>Tổng người dùng</h5>
                <h4 class="text-warning" th:text="${totalUsers}">0</h4>
            </div>
        </div>
    </div>

    <!-- Biểu đồ -->
    <div class="chart-container">
        <h5>Doanh thu theo ngày</h5>
        <canvas id="revenueChart" height="100"></canvas>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const ctx = document.getElementById('revenueChart').getContext('2d');
        const labels = /*[[${chartLabels}]]*/ [];
        const data = /*[[${chartData}]]*/ [];

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Doanh thu (đ)',
                    data: data,
                    borderColor: '#3498db',
                    backgroundColor: 'rgba(52, 152, 219, 0.2)',
                    fill: true,
                    tension: 0.4,
                    pointBackgroundColor: '#3498db',
                    pointRadius: 4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return 'Doanh thu: ' + context.parsed.y.toLocaleString() + ' đ';
                            }
                        }
                    }
                },
                scales: {
                    y: { beginAtZero: true, grid: { color: '#ecf0f1' } },
                    x: { grid: { display: false } }
                }
            }
        });
    });
</script>

</body>
</html>