<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giỏ hàng - VanlangBooks</title>

    <link rel="stylesheet" th:href="@{/css/cart.css}">
    <link rel="stylesheet" th:href="@{/css/headerandfooter.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
        .cart-container { max-width: 1000px; margin: 40px auto; padding: 20px; font-family: 'Segoe UI', sans-serif; }
        .cart-empty { text-align: center; padding: 60px; color: #636e72; font-size: 1.4em; }
        .cart-empty i { font-size: 80px; color: #ddd; display: block; margin-bottom: 20px; }
        .cart-items { display: grid; gap: 20px; margin: 30px 0; }
        .cart-item {
            display: flex; align-items: center; background: white; padding: 20px;
            border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); gap: 20px;
        }
        .cart-item img { width: 100px; height: 140px; object-fit: cover; border-radius: 8px; }
        .cart-item h4 { margin: 0 0 10px; font-size: 1.3em; color: #2d3436; }
        .cart-item p { margin: 8px 0; color: #636e72; }
        .cart-item .price { font-weight: bold; color: #e17055; font-size: 1.2em; }
        .btn-remove {
            margin-left: auto; background: #d63031; color: white; padding: 10px 20px;
            border-radius: 50px; text-decoration: none; font-size: 0.9em;
        }
        .btn-remove:hover { background: #c23616; }
        .cart-summary {
            background: #f8f9fa; padding: 25px; border-radius: 12px; text-align: right;
            margin-top: 30px; font-size: 1.3em;
        }
        .cart-summary p { margin: 0 0 20px; }
        .cart-summary span { color: #e17055; font-weight: bold; }
        .btn {
            display: inline-block; padding: 14px 30px; margin-left: 15px;
            background: #74b9ff; color: white; text-decoration: none; border-radius: 50px;
            font-weight: bold; transition: all 0.3s;
        }
        .btn:hover { background: #0984e3; transform: translateY(-3px); }
        #checkout-btn { background: #e17055; }
        #checkout-btn:hover { background: #d63031; }
        @media (max-width: 768px) {
            .cart-item { flex-direction: column; text-align: center; }
            .btn-remove { margin: 10px auto 0; }
        }
    </style>
</head>
<body>

<div th:replace="~{fragments/header :: header-nav}"></div>

<main class="cart-container">
    <h2>Giỏ hàng của bạn</h2>

    <!-- Giỏ hàng trống -->
    <div th:if="${cart == null || #maps.isEmpty(cart)}" class="cart-empty">
        <i class="fas fa-shopping-cart"></i>
        <p>Giỏ hàng của bạn đang trống.</p>
        <a th:href="@{/}" style="color:#74b9ff;font-weight:bold;">Tiếp tục mua sắm ngay!</a>
    </div>

    <!-- Có sản phẩm trong giỏ -->
    <div th:unless="${cart == null || #maps.isEmpty(cart)}">

        <div class="cart-items">
            <div th:each="entry : ${cart}" class="cart-item">
                <!-- Lấy thông tin sách từ service hoặc từ model (ở đây giả sử bạn đã add book vào model) -->
                <th:block th:with="book=${bookService.findById(entry.key)}">
                    <img th:src="@{${book != null && book.image != null ? book.image : '/images/no-image.jpg'}}"
                         alt="Ảnh sách"
                         onerror="this.src='/images/no-image.jpg'">

                    <div>
                        <h4 th:text="${book != null ? book.title : 'Sách không tồn tại'}">Tên sách</h4>
                        <p>Giá: <span class="price" th:text="${book != null ? #numbers.formatDecimal(book.price, 0, 'COMMA', 0, 'POINT') + ' ₫' : 'N/A'}">65.570 ₫</span></p>
                        <p>Số lượng: <strong th:text="${entry.value}">1</strong></p>
                        <p>Thành tiền: <strong style="color:#e17055;"
                                               th:text="${book != null ? #numbers.formatDecimal(book.price * entry.value, 0, 'COMMA', 0, 'POINT') + ' ₫' : 'N/A'}">
                            65.570 ₫</strong></p>
                    </div>

                    <a th:href="@{|/cart/remove/${entry.key}|}" class="btn-remove">
                        <i class="fas fa-trash-alt"></i> Xóa
                    </a>
                </th:block>
            </div>
        </div>

        <div class="cart-summary">
            <p>Tổng cộng:
                <span id="cart-total"
                      th:text="${#aggregates.sum(cart.entrySet().![bookService.findById(key).price * value])} + ' ₫'">0 ₫</span>
            </p>
            <a id="checkout-btn" class="btn" th:href="@{/checkout}">Thanh toán ngay</a>
            <a id="continue-shopping-btn" class="btn" th:href="@{/}">Tiếp tục mua sắm</a>
        </div>
    </div>
</main>

<div th:replace="~{fragments/footer :: footer}"></div>

</body>
</html>